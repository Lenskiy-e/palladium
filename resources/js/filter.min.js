$(document).on('change', 'input[name="param[]"]', function(){
    filter();
})

$(document).on('click', '.filter_delete', function(){
    $("#param-" . $(this).data('id')).removeAttr('checked');
    filter();
});

$(document).on('click', '#filter-btn', function(){
    window.location.replace($(this).data('redirect'));
});

$(document).on('click', '#filter-reset', function(){
    window.location.replace($(this).data('redirect'));
});

function filter()
{
    var filters = [];
    var params = $('input[name="param[]"]:checked');
    params.each(function(){
        filters.push($(this).val());
    })
    var filter_btn = $(document).find("#filter-btn");

    $.ajax({
        url: "/filter/generate",
        type: "post",
        data:   params.serialize()
            + '&id=' + $('input[name="id"]').val()
            + '&base_url=' + $('input[name="base_url"]').val()
            + '&_token=' + $("input[name='_token']").val(),
        success: function(response){

            if(response)
            {
                if(response.url)
                {

                    filter_btn.attr('data-redirect', response.url).show();
                }else
                {
                    filter_btn.attr('data-redirect', "/" + $('input[name="base_url"]').val()).show();
                }
                filter_btn.text( filter_btn.data('text') + ' (' + response.count + ')');
                $("#filters").replaceWith(response.filter);
            }
        }
    });
}

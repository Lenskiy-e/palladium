$(document).on('change', 'input[name="param[]"]', function(){
    $("#head-param-" + $(this).val()).remove();
    filterIt();
})

$(document).on('click', '.filter_delete', function(){
    $("#head-param-" + $(this).data('id')).remove();
    $("#param-" + $(this).data('id')).removeAttr('checked');
    filterIt();
});



$(document).on('click', '#filter-btn', function(){
    window.location.replace($(this).data('redirect'));
});

$(document).on('click', '#filter-reset', function(){
    window.location.replace($(this).data('redirect'));
});


function filterIt() {

    var filters = [];

    var params = $('input[name="param[]"]:checked');

    params.each(function()
    {
        filters.push($(this).val());
    })
    var filter_btn = $(document).find("#filter-btn");

    $.ajax
    ({
        url: "/filter/generate",
        type: "post",
        data: $("form[name='filter_form']").serialize(),
        success: function(response){

            if(response.status === 'success')
            {
                if(response.count === 0 || filters.length === 0)
                {
                    $("#filter-btn").addClass('hide');
                    return false;
                }
                if(response.url)
                {
                    filter_btn.attr('data-redirect', response.url).show();
                }else
                {
                    filter_btn.attr('data-redirect', "/" + $('input[name="base_url"]').val()).show();
                }

                filter_btn.text( filter_btn.data('text') + ' (' + response.count + ')');

                $("#filters").replaceWith(response.filter);
            }

            if(response.status === 'error')
            {
                alert(response.message);
            }
        }
    });
}
